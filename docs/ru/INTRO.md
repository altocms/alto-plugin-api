# Alto CMS Restful API - INTRO

## Requests

Два режима работы:
* С авторизацией приложения
* Без авторизации приложения

Авторизация приложения используется для того, чтобы определить, какие приложения могут работать с API сайта. Для этого в конфиге задается перечень допустимых ключей приложений для работы сайта:
```
$config[‘module’][‘api’][‘applications’] = array(
    ‘1234567890’ => array(
        ‘name’ => ‘Mobile Application’,
        'secret_key' => 'qwerty',
    ),
);
```

Здесь `‘1234567890’`` - это ключ приложения, а ‘name’ - это название приложения.

Для того, чтобы внешнее приложение могло работать с API сайта, это приложение должно в каждом запросе к API передавать HTTP-заголовок ‘X-Alto-Application-Key’ с ключом приложения.

Пример:
```
Accept: */*
Content-Type: application/x-www-form-urlencoded
X-Alto-Application-Key: 1234567890
```

Для каждого сайта может быть указано любое число приложений со своими ключами.

Если в ‘module.api.applications’ задан пустой массив, то авторизация приложения не выполняется, т.е. любое внешнее приложение может обращаться к API сайта.

## Request formats

Формат запроса указывается в заголовке Content-Type. Возможные форматы запросов:
application/x-www-form-urlencoded
multipart/form-data
application/json

При использовании формата application/json параметры в теле запроса передаются, как json-объект. Например:
```
POST /api/users/login/ HTTP/1.1
Host: site.com
Content-Length: ...
Content-Type: application/json
X-Alto-Application-Key: 1234567890

{
    "emai": “admin@admin.ad”,
    "password": “qwerty”
}
```

## Responses

В ответ на каждый запрос сайт дает ответ в формате json, где обязательными свойствами являются:
error - код ошибки, если есть, либо 0, если запрос обработан успешно
message - сообщение для клиента (это может быть как текстовое сообщение об ошибке, так и уведомление об успешном выполнении операции)
data - это json-объект, который содержит запрашиваемые клиентом данные (либо пустой объект, если произошла ошибка или запрос не подразумевает возвращаемые данные).

Например:
```
{
	error: 0,
	message: ‘’,
	data: {
		user: { … }
	}
}
```
## Authorization & Identification

Для авторизации пользователя его данные (логин или емейл и пароль) передаются на сайт. В случае успешной авторизации сайт возвращает в качестве одного из параметров токен авторизации (см. /users/login). В дальнейшем этот токен должен использоваться для идентификации пользователя. Это может выполняться тремя способами:
* Токен передается в HTTP-заголовке, как ‘X-Alto-Auth-Token’
* Токен передается в теле запроса, как ‘auth_token’
* Токен передается в параметрах GET-запроса, как ‘auth-token’


